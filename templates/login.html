{% extends "base.html" %}
{% block title %}Sign In — DOZO{% endblock %}

{% block content %}

<div class="auth-wrapper">

  <!-- Left panel: branding -->
  <div class="auth-panel auth-panel-left">
    <div class="auth-brand">
      <div class="auth-logo">DZ</div>
      <p class="auth-tagline">Where tasks get done.</p>
    </div>
    <div class="auth-art">
      <div class="art-grid">
        {% for i in range(25) %}
        <div class="art-cell" style="--i: {{ i }}"></div>
        {% endfor %}
      </div>
      <div class="art-ring ring-1"></div>
      <div class="art-ring ring-2"></div>
    </div>
    <div class="auth-quote">
      <span class="quote-mark">"</span>
      <p>A goal without a plan is just a wish.</p>
      <cite>— Antoine de Saint-Exupéry</cite>
    </div>
  </div>

  <!-- Right panel: form -->
  <div class="auth-panel auth-panel-right">
    <div class="auth-form-wrap">

      <div class="auth-header">
        <h1 class="auth-title">Welcome back.</h1>
        <p class="auth-sub">Sign in to access your workspace.</p>
      </div>

      <form class="auth-form" method="POST" action="{{ url_for('auth.login') }}" novalidate id="loginForm">
        {{ form.hidden_tag() }}

        <div class="form-group" id="fg-email">
          <label class="form-label" for="email">Email</label>
          <div class="input-wrap">
            <span class="input-icon">@</span>
            {{ form.email(class="form-input", id="email", placeholder="you@example.com", autocomplete="email") }}
            <span class="input-focus-bar"></span>
          </div>
          {% if form.email.errors %}
          <span class="form-error">{{ form.email.errors[0] }}</span>
          {% endif %}
        </div>

        <div class="form-group" id="fg-password">
          <div class="form-label-row">
            <label class="form-label" for="password">Password</label>
            <a href="#" class="form-link">Forgot password?</a>
          </div>
          <div class="input-wrap">
            <span class="input-icon">⌘</span>
            {{ form.password(class="form-input", id="password", placeholder="••••••••", autocomplete="current-password") }}
            <button type="button" class="input-toggle-pw" aria-label="Toggle password" id="togglePw">
              <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
            <span class="input-focus-bar"></span>
          </div>
          {% if form.password.errors %}
          <span class="form-error">{{ form.password.errors[0] }}</span>
          {% endif %}
        </div>

        <div class="form-group form-group-check">
          {{ form.remember(class="form-checkbox", id="remember") }}
          <label for="remember" class="checkbox-label">Keep me signed in</label>
        </div>

        <button type="submit" class="btn btn-primary btn-full" id="submitBtn">
          <span class="btn-text">Sign In</span>
          <span class="btn-spinner" id="btnSpinner"></span>
          <span class="btn-icon">→</span>
        </button>

        <p class="auth-switch">
          Don't have an account?
          <a href="{{ url_for('auth.register') }}" class="form-link">Create one →</a>
        </p>
      </form>

    </div>
  </div>

</div>

{% endblock %}

{% block extra_js %}
<script>
  // Password toggle
  const togglePw = document.getElementById('togglePw');
  const pwInput = document.getElementById('password');
  togglePw.addEventListener('click', () => {
    const isText = pwInput.type === 'text';
    pwInput.type = isText ? 'password' : 'text';
    togglePw.style.opacity = isText ? '0.4' : '1';
  });

  // Shake on error
  document.querySelectorAll('.form-error').forEach(err => {
    err.closest('.form-group').classList.add('has-error');
  });

  // Submit loading state
  document.getElementById('loginForm').addEventListener('submit', () => {
    const btn = document.getElementById('submitBtn');
    btn.classList.add('loading');
  });

  // Floating label effect
  document.querySelectorAll('.form-input').forEach(input => {
    input.addEventListener('focus', () => {
      input.closest('.form-group').classList.add('focused');
    });
    input.addEventListener('blur', () => {
      input.closest('.form-group').classList.remove('focused');
      if (input.value) input.closest('.form-group').classList.add('filled');
      else input.closest('.form-group').classList.remove('filled');
    });
  });
</script>
{% endblock %}